name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted  # ⚠️ পরিবর্তন: ubuntu-latest এর বদলে self-hosted

    steps:
    - name: Deploy Application
      run: |
        # ১. আপনার অ্যাপের ফোল্ডারে যাওয়া
        cd ~/apps/backend-ecommerce-v1
        
        # ২. গিটহাব থেকে নতুন কোড নামানো
        git pull origin main
        
        # ৩. ডকার কন্টেইনার নতুন করে বিল্ড এবং রিস্টার্ট করা
        docker compose down
        docker compose up -d --build
        
        # ৪. ক্লিনআপ (পুরানো ইমেজ মুছে ফেলা)
        docker image prune -f